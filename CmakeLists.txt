cmake_minimum_required(VERSION 3.10)
project(compiler)

# 设置C++标准
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# 源文件
set(SOURCES
    src/main.cpp
    src/lexer.cpp
)

# 头文件目录
include_directories(src)

# 可执行文件
add_executable(compiler ${SOURCES})

# ----------------------------
# GoogleTest 配置
# ----------------------------
enable_testing()
add_subdirectory(third_party/googletest)

include_directories(${gtest_SOURCE_DIR}/include)

# ----------------------------
# 自动添加 test/*.cpp 为测试用例
# ----------------------------
file(GLOB TEST_SOURCES "test/*.txt")

foreach(test_src ${TEST_SOURCES})
    get_filename_component(test_name ${test_src} NAME_WE)

    add_executable(${test_name}
        ${test_src}
        src/lexer.cpp         # 若测试依赖 lexer
    )

    target_include_directories(${test_name} PRIVATE include)
    target_link_libraries(${test_name} gtest gtest_main)

    add_test(NAME ${test_name} COMMAND ${test_name})
endforeach()